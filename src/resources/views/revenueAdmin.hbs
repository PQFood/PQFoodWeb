<div class="container-xxl py-5">
    <div class="container">
        <div class="text-center wow fadeInUp" data-wow-delay="0.1s">
            <h3 class="section-title ff-secondary text-center text-primary fw-normal">Doanh thu</h3>
        </div>
        <div class="tab-class text-center wow fadeInUp" data-wow-delay="0.1s">
            <ul class="nav nav-pills d-inline-flex justify-content-center border-bottom mb-5">
                <li class="nav-item">
                    <a class="d-flex align-items-center text-start mx-3 ms-0 pb-3 active" data-bs-toggle="pill"
                        href="#tab-1">
                        <i class="fas fa-dollar-sign fa-2x text-primary"></i>
                        <div class="ps-3">
                            <small class="text-body">Doanh thu</small>
                            <h6 class="mt-n1 mb-0">Ngày</h6>
                        </div>
                    </a>
                </li>
                <li class="nav-item">
                    <a class="d-flex align-items-center text-start mx-3 me-0 pb-3" data-bs-toggle="pill"
                        href="#tabChart">
                        <i class="fas fa-dollar-sign fa-2x text-primary"></i>

                        <div class="ps-3">
                            <small class="text-body">Doanh thu</small>
                            <h6 class="mt-n1 mb-0">Tháng</h6>
                        </div>
                    </a>
                </li>
            </ul>
            <div class="tab-content">
                <div id="tab-1" class="tab-pane fade show p-0 active">

                    <div class="row g-4">
                        {{#if total}}
                        <h3 class="mt-3 mb-3 number" style="text-align: center; color:rgb(194, 174, 230);">{{total}}
                        </h3>
                        {{else}}
                        <h3 class="mt-3 mb-3 number" style="text-align: center; color:rgb(194, 174, 230);">0
                        </h3>
                        {{/if}}
                        <form action="/admin/revenue" method="get" id="revenueDay">
                            <div class="d-flex justify-content-center">
                                <div class="form-group">
                                    <div class="input-group date" id="datetimepicker4" data-target-input="nearest">
                                        <input type="text" class="form-control datetimepicker-input w-75"
                                            data-target="#datetimepicker4" placeholder="Thời gian" id="timeRevenue"
                                            name="timeRevenue" style="height: 40px;"
                                            data-toggle="datetimepicker" />&nbsp;&nbsp;
                                        <div class="input-group-append" data-target="#datetimepicker4"
                                            data-toggle="datetimepicker">
                                            <div class="input-group-text" style="height: 40px;"><i
                                                    class="fa fa-calendar"></i></div>
                                        </div>
                                    </div>
                                </div>&nbsp;&nbsp;
                                <div class="">
                                    <button class="btn btn-primary" type="submit" style="height: 40px;">Xem</button>
                                </div>
                            </div>
                        </form>
                    </div>
                </div>
                <div id="tabChart" class="tab-pane fade show p-0 bg-dark p-2">
                    <canvas id="myChart" class="w-98"></canvas>
                    <div class="mt-1 text-center">
                        <h3 class="mt-3 mb-3" style="text-align: center; color:rgb(194, 174, 230);">Tổng doanh thu:
                            <span id='totalYear'></span>
                        </h3>
                        <div class="">
                            <div class="d-flex justify-content-center">
                                <div class="form-floating w-25">
                                    <select id="year" class="form-select" name="year"></select>
                                    <label for="year">Năm</label>
                                </div>
                                &nbsp;&nbsp;
                                <div class="form-floating w-25">
                                    <select class="form-select" id="type" name="type">
                                        <option value="bar">Cột</option>
                                        <option value="line">Đường</option>
                                        <option value="pie">Tròn</option>
                                    </select>
                                    <label for="type">Loại</label>
                                </div>
                                &nbsp;&nbsp;
                                <div class="">
                                    <button class="btn btn-primary py-3 px-4" onclick="changeYearType()">Xem</button>
                                </div>
                            </div>
                        </div>
                    </div>

                </div>
            </div>
        </div>
    </div>
</div>

<div style="display: none;" id="ArrTotalMonth">
    {{arr}}
</div>

<script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/3.6.0/chart.min.js"></script>


<script>

    document.getElementById("linkHome").classList.remove("active");
    document.getElementById("linkRevenue").classList.add("active");
    function btnDelete(slug) {
        Swal.fire({
            title: 'Bạn có chắc muốn xóa bàn ăn này?',
            text: "Bạn sẽ không thể khôi phục nếu tiếp tục!",
            icon: 'warning',
            showCancelButton: true,
            confirmButtonColor: '#3085d6',
            cancelButtonColor: '#d33',
            confirmButtonText: 'Tiếp tục',
            cancelButtonText: 'Quay lại'
        }).then((result) => {
            if (result.isConfirmed) {
                window.location.replace("/admin/deleteDinnerTable/" + slug);
            }
        })
    }
</script>

<script>
    var start = 2020;
    var end = new Date().getFullYear() + 50;
    var options = "";
    for (var year = start; year <= end; year++) {
        options += "<option value='" + year + "'>" + year + "</option>";
    }
    document.getElementById("year").innerHTML = options;
</script>

{{!--
<script>

    $.ajax('/admin/getData',
        {
            dataType: 'json',
            async: 'true',
            type: 'GET',
            success: function (data, status, xhr) {
                var pathName = window.location.href;
                var totalYear = 0
                for (var i = 0; i < data.length; i++) {
                    data[i] = parseInt(data[i]);
                    totalYear += data[i];
                }
                const change = new Intl.NumberFormat('vi-VN', {
                    style: 'currency',
                    currency: 'VND',
                })
                document.getElementById('totalYear').innerHTML = change.format(totalYear);

                var type = pathName.split('type=')[1];
                if (!type || (type != 'pie' && type != 'line')) type = 'bar';

                const ctx = document.getElementById('myChart').getContext('2d');
                const myChart = new Chart(ctx, {
                    type: type,
                    data: {
                        labels: ['Tháng 1', 'Tháng 2', 'Tháng 3', 'Tháng 4', 'Tháng 5', 'Tháng 6',
                            'Tháng 7', 'Tháng 8', 'Tháng 9', 'Tháng 10', 'Tháng 11', 'Tháng 12'],
                        datasets: [{
                            label: 'Doanh thu',
                            data: data,
                            backgroundColor: [
                                'rgba(255, 99, 132, 0.2)',
                                'rgba(54, 162, 235, 0.2)',
                                'rgba(255, 206, 86, 0.2)',
                                'rgb(179, 255, 179)',
                                'rgba(153, 102, 255, 0.2)',
                                'rgba(255, 159, 64, 0.2)',
                                'rgba(153, 0, 153, 0.2)',
                                'rgba(153, 153, 102, 0.2)',
                                'rgba(0, 0, 255, 0.2)',
                                'rgb(0, 255, 0, 0.2)',
                                'rgba(255, 64, 0, 0.3)',
                                'rgba(204, 0, 153, 0.3)'
                            ],
                            borderColor: [
                                'rgba(255, 99, 132, 1)',
                                'rgba(54, 162, 235, 1)',
                                'rgba(255, 206, 86, 1)',
                                'rgba(75, 192, 192, 1)',
                                'rgba(153, 102, 255, 1)',
                                'rgba(255, 159, 64, 1)',
                                'rgba(153, 0, 153, 1)',
                                'rgba(153, 153, 102, 1)',
                                'rgba(0, 0, 255, 1)',
                                'rgba(0, 255, 0, 1)',
                                'rgba(255, 64, 0, 1)',
                                'rgba(204, 0, 153, 1)'
                            ],
                            borderWidth: 1
                        }]
                    },
                    options: {
                        scales: {
                            y: {
                                beginAtZero: true,
                                ticks: {
                                    callback: function (value, index, values) {
                                        return change.format(value)
                                    }
                                }
                            }
                        },
                        responsive: true,
                        plugins: {
                            title: {
                                display: true,
                                text: 'Biểu đồ doanh thu qua từng tháng',
                                font: {
                                    family: 'Times',
                                    size: 20,
                                    style: 'normal',
                                    lineHeight: 1.2
                                },
                            }
                        },
                    }
                });

            },
            error: function (jqXhr, textStatus, errorMessage) {
                alert(errorMessage);
            }
        });

    function destroy() {
        myChart.destroy();

    }

</script> --}}
<script>
    var arr = document.getElementById('ArrTotalMonth').innerText;
    var data = arr.split(',');
    var totalYear = 0
    for (var i = 0; i < data.length; i++) {
        data[i] = parseInt(data[i]);
        totalYear += data[i];
    }
    const change = new Intl.NumberFormat('vi-VN', {
        style: 'currency',
        currency: 'VND',
    })
    document.getElementById('totalYear').innerHTML = change.format(totalYear);

    const ctx = document.getElementById('myChart').getContext('2d');

    const myChart = new Chart(ctx, {
        type: 'bar',
        data: {
            labels: ['Tháng 1', 'Tháng 2', 'Tháng 3', 'Tháng 4', 'Tháng 5', 'Tháng 6',
                'Tháng 7', 'Tháng 8', 'Tháng 9', 'Tháng 10', 'Tháng 11', 'Tháng 12'],
            datasets: [{
                label: 'Doanh thu',
                data: data,
                backgroundColor: [
                    'rgba(255, 99, 132, 0.2)',
                    'rgba(54, 162, 235, 0.2)',
                    'rgba(255, 206, 86, 0.2)',
                    'rgb(179, 255, 179)',
                    'rgba(153, 102, 255, 0.2)',
                    'rgba(255, 159, 64, 0.2)',
                    'rgba(153, 0, 153, 0.2)',
                    'rgba(153, 153, 102, 0.2)',
                    'rgba(0, 0, 255, 0.2)',
                    'rgb(0, 255, 0, 0.2)',
                    'rgba(255, 64, 0, 0.3)',
                    'rgba(204, 0, 153, 0.3)'
                ],
                borderColor: [
                    'rgba(255, 99, 132, 1)',
                    'rgba(54, 162, 235, 1)',
                    'rgba(255, 206, 86, 1)',
                    'rgba(75, 192, 192, 1)',
                    'rgba(153, 102, 255, 1)',
                    'rgba(255, 159, 64, 1)',
                    'rgba(153, 0, 153, 1)',
                    'rgba(153, 153, 102, 1)',
                    'rgba(0, 0, 255, 1)',
                    'rgba(0, 255, 0, 1)',
                    'rgba(255, 64, 0, 1)',
                    'rgba(204, 0, 153, 1)'
                ],
                borderWidth: 1
            }]
        },
        options: {
            scales: {
                y: {
                    beginAtZero: true,
                    ticks: {
                        callback: function (value, index, values) {
                            return change.format(value)
                        }
                    }
                }
            },
            responsive: true,
            plugins: {
                title: {
                    display: true,
                    text: 'Biểu đồ doanh thu qua từng tháng',
                    font: {
                        family: 'Times',
                        size: 20,
                        style: 'normal',
                        lineHeight: 1.2
                    },
                }
            },
        }
    });

</script>

<script>
    function changeYearType() {
        var yearSend = document.getElementById('year').value;
        var typeSend = document.getElementById('type').value;

        $.ajax('/admin/getData',
            {
                dataType: 'json',
                type: 'GET',
                data: {
                    year: yearSend,
                },
                success: function (data, status, xhr) {
                    var pathName = window.location.href;
                    var totalYear = 0
                    for (var i = 0; i < data.length; i++) {
                        data[i] = parseInt(data[i]);
                        totalYear += data[i];
                    }
                    const change = new Intl.NumberFormat('vi-VN', {
                        style: 'currency',
                        currency: 'VND',
                    })

                    document.getElementById('totalYear').innerHTML = change.format(totalYear);

                    myChart.data.datasets[0].type = typeSend
                    myChart.data.datasets[0].data = data;
                    myChart.update();

                },
                error: function (jqXhr, textStatus, errorMessage) {
                    alert(errorMessage);
                }
            });
    }
</script>